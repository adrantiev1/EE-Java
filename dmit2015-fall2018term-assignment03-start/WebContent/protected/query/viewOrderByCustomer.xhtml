<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:f5="http://xmlns.jcp.org/jsf/passthrough" 	
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:b="http://bootsfaces.net/ui" 
	xmlns:p="http://primefaces.org/ui"
	xmlns:hf="http://highfaces.org"
	template="/WEB-INF/templates/template-assignment03.xhtml">

	<ui:param name="title" value="#{text['page_viewOrderByCustomer.title']}" />
	
	<ui:define name="head">
<f:verbatim>
<!-- 
		<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true&amp;key=${initParam['GoogleAPIkey']}"></script>
 -->	
</f:verbatim>	
	</ui:define>

	<ui:define name="maincontent">
	
		<b:jumbotron>
			<h1>#{text['page_viewOrderByCustomer.title']}</h1>
		</b:jumbotron>
		
		<b:messages id="messages" />
				
		<b:form id="queryForm"  >
				
			<b:inputText id="searchValue"
				value="#{orderQueryController.queryCustomerValue}"
				label="CustomerId, Email, or Phone Number"
				placeholder="enter customerId, email or phone">
				<b:focus />
			</b:inputText>
			
			<b:commandButton value="Search"
				look="info"
				icon-awesome="search"
				ajax="true"
				update="queryCustomerSingleResultPanel queryForm:queryResultListPanel queryForm:querySingleResultPanel messages"
				actionListener="#{orderQueryController.findCustomer()}">
			</b:commandButton>	
			<b:commandButton value="Cancel"
				icon-awesome="ban"
				look="default"
				immediate="true"
				update="queryForm:queryCustomerSingleResultPanel queryForm:querySingleResultPanel messages"
				actionListener="#{orderQueryController.cancel()}">
			</b:commandButton>		
			
			<p:outputPanel id="queryCustomerSingleResultPanel" >
				<b:panel title="Customer Detail" rendered="#{(orderQueryController.queryCustomerSingleResult != null) and (orderQueryController.queryOrderResultList == null)}">
					<b:column span="6">
									<b:panel title="Customer Details" collapsible="false" style="height: 250px">
											<strong>
												<h:outputText value="#{orderQueryController.queryCustomerSingleResult.custFirstName} 
																	 #{orderQueryController.queryCustomerSingleResult.custLastName}" /> <br />
																	 
												<h:outputText value="#{orderQueryController.queryCustomerSingleResult.custAddress.streetAddress}" /> <br />
												<h:outputText value="#{orderQueryController.queryCustomerSingleResult.custAddress.city} 
																	 #{orderQueryController.queryCustomerSingleResult.custAddress.stateProvince} 
																	 #{orderQueryController.queryCustomerSingleResult.custAddress.postalCode}" 
																		 /> <br />
												<h:outputText value="#{orderQueryController.queryCustomerSingleResult.custAddress.countryId}" /> <br />	
												<c:forEach var="item" items="#{orderQueryController.queryCustomerSingleResult.phoneNumbers}">
													<tr>
														<td class="text-right">
															<h:outputText value="#{item}">
																<f:convertNumber type="number"/>
															</h:outputText>
														</td>
													</tr>
										</c:forEach>
											</strong>
									</b:panel>
						</b:column>
					
				</b:panel>

				<b:commandButton value="View Customer Orders"
					rendered="#{(orderQueryController.queryCustomerSingleResult != null) and (orderQueryController.queryOrderResultList == null)}"
					look="info"
					ajax="true"
					update="queryCustomerSingleResultPanel queryForm:queryResultListPanel queryForm:querySingleResultPanel messages"
					actionListener="#{orderQueryController.findOrdersByCustomer()}">
				</b:commandButton>	
				
			</p:outputPanel>
			
			<p:outputPanel id="queryResultListPanel">
			
				<b:panel title="Customer Orders" rendered="#{(orderQueryController.queryOrderResultList != null) and (orderQueryController.queryOrderSingleResult == null)}">
					<b:dataTable id="bootsfacesTable"
						value="#{orderQueryController.queryOrderResultList}"
						var="item"
						rendered="true"
						searching="false"
						paginated="false">
						
						<b:dataTableColumn value="#{item.orderId}">
							<f:facet name="header">
								Order ID
							</f:facet>
						</b:dataTableColumn>
		
						<b:dataTableColumn  label="Order Date">
							<h:outputText value="#{item.orderDate}">
								
							<f:convertDateTime pattern="MMMM d,yyyy"/>
							</h:outputText>	
						</b:dataTableColumn>
							
						
						<b:dataTableColumn styleClass="text-right">
							<f:facet name="header">
								Order Total
							</f:facet>
							<h:outputText value="#{item.orderTotal}">
								<f:convertNumber type="currency" currencySymbol="$"/>
							</h:outputText>
						</b:dataTableColumn>
						
						<b:dataTableColumn value="#{item.orderMode}">
							<f:facet name="header">
								Order Mode
							</f:facet>
						</b:dataTableColumn>
						
						<b:dataTableColumn value="#{item.orderStatus}">
							<f:facet name="header">
								Order Status
							</f:facet>
						</b:dataTableColumn>
						
						<b:dataTableColumn value="#{item.customer.custFirstName} 
												  #{item.customer.custLastName}">
							<f:facet name="header">
								Customer Name
							</f:facet>						  
						</b:dataTableColumn>
						
						<b:dataTableColumn value="#{item.salesRep.firstName} 
												  #{item.salesRep.lastName}">
							<f:facet name="header">
								Sales Rep
							</f:facet>
						</b:dataTableColumn>
																		
						<b:dataTableColumn>
							<f:facet name="header">
								Action
							</f:facet>
							<b:commandButton value="view details" 
								look="link"
								actionListener="#{orderQueryController.findOrder(item.orderId)}"
								ajax="true" update="queryForm:querySingleResultPanel queryForm:queryResultListPanel">
							</b:commandButton>
						</b:dataTableColumn>
	
					</b:dataTable>

				</b:panel>
			</p:outputPanel>
			
			<p:outputPanel id="querySingleResultPanel">
			
				<b:panel title="Order Details" rendered="#{not empty orderQueryController.queryOrderSingleResult}">

						
				</b:panel>
			
			</p:outputPanel>
	
		</b:form>


	</ui:define>

</ui:composition>
